<div class="playground">

  <div style="flex:1; display: flex; flex-direction: column">
    <div style="flex:1; display: flex;">
      <div style="width: 500px; display: flex; flex-direction: column">
        <div style="flex: 1 100px; overflow-y: auto">
          <div class="form">
            <ng-form (ngSubmit)="parseFromUrl()">
              <div class="row" style="text-align: left">
                <div aria-label="The URL you want to RSSify" class="tooltip bottom col-lg-8">
                  <input (keyup.enter)="parseFromUrl()"
                         [(ngModel)]="url"
                         [autofocus]="true"
                         [ngClass]="{'active': !hasResults}"
                         autocomplete="off"
                         autofocus
                         name="url"
                         placeholder="Enter the Url to convert into RSS"
                         required="true"
                         style="width: 100%"
                         type="url">
                </div>
                <div class="col-lg-4">
                  <a (click)="parseFromUrl()" class="button secondary" href="javascript:void(0)">
                    Show Feeds
                  </a>
                </div>
              </div>
              <div *ngIf="hasJsSupport"
                   style="border-bottom: 1px solid #cccccc; padding-bottom: 10px; margin-bottom: 20px">
                <label><input [(ngModel)]="options.js" name="jsSupport" type="checkbox">Enable JavaScript Support</label>
              </div>
              <div>

                <div *ngIf="(url?.length === 0 || !isLoading && !hasResults) && history.length > 0">
                  <p><strong>Previous Queries</strong></p>
                  <p *ngFor="let url of history">
                    <a (click)="parseFromHistoryUrl(url)" href="javascript:void(0)">{{ url }}</a>
                  </p>
                </div>
              </div>
            </ng-form>
          </div>

          <div *ngIf="canChooseFeed()">
            <p class="wizard_section"><strong>2.</strong> Choose a feed</p>
            <p>Native Feeds Found in DOM:</p>
            <ul class="list-of-feeds">
              <li *ngFor="let feed of response.results.nativeFeeds"><a [href]="feed.url" target="_blank">{{ feed.title }}</a></li>
            </ul>
          </div>

          <div *ngIf="response?.results?.genericFeedRules?.length > 0" style="margin-top: 10px">
            <p>There are {{response.results.genericFeedRules?.length}} feeds in this site, pick one:</p>
            <ul class="list-of-feeds">
              <li *ngFor="let rule of response.results.genericFeedRules; let i = index "
                  [ngClass]="{'active': isCurrentRule(rule)}"
                  style="display: block">
                <a href="javascript:void(0)"
                   class="tooltip"
                   aria-label="Try to visualize and scroll to articles in website"
                   (click)="applyRule(rule)">Feed with <strong>{{ rule.count }}</strong> articles</a>
<!--                <span *ngIf="i === 0">-->
<!--                <strong> - highest score</strong>-->
<!--                </span>-->
                <ul *ngFor="let article of rule.samples;" style="border-left: 1px solid #ccc">
                  <li>
                    {{article.title}}
                  </li>
                </ul>
              </li>
            </ul>
          </div>

          <div *ngIf="canChooseFeed()">
            <p>Or enter custom rule:</p>
            <ng-form (ngSubmit)="applyCustomRule()">
              <div class="row" style="text-align: left">
                <div aria-label="Elements XPath (e.g. //body//ul[1]/li)" class="tooltip bottom col-lg-8">
                  <input [(ngModel)]="customContextXPath" autocomplete="off" autofocus name="context"
                    style="width: 100%" placeholder="Elements XPath">
                </div>
                <div aria-label="Links relative XPath (e.g. ./a[1])" class="tooltip bottom col-lg-8">
                  <input [(ngModel)]="customLinkXPath" autocomplete="off" name="link" style="width: 100%"
                    placeholder="Links relative XPath">
                </div>
                <div class="col-lg-4">
                  <a (click)="applyCustomRule()" class="button secondary" href="javascript:void(0)">
                    Apply
                  </a>
                </div>
              </div>
            </ng-form>
          </div>

          <div *ngIf="currentRule">
            <p class="wizard_section"><strong>2.</strong> Filter</p>
            <ul style="list-style: none">
              <li style="display: flex">
                <select>
                  <option>Keep</option>
                  <option>Reject</option>
                </select>
                <select>
                  <option>Title</option>
                  <option>Body</option>
                </select>
                <select>
                  <option>Contains</option>
                  <option>Not Contains</option>
                </select>
                <input>
                <button>x</button>
              </li>

            </ul>
          </div>

          <div *ngIf="currentRule">
            <p class="wizard_section"><strong>3.</strong> Content</p>
            <ul style="list-style: none">
              <!--            todo mag enable -->
              <!--            <li><input type="checkbox" [(ngModel)]="excludeItemsThatContain"> Remove items that contain <a href="https://github.com/damoeb/rss-proxy/wiki/Filters#text-filter" target="_blank">one of</a> (comma separated) <input type="text" name="excludeItemsThatContainTexts" [(ngModel)]="excludeItemsThatContainTexts"></li>-->
<!--              <li>-->
<!--                <p>Output Format</p>-->
<!--                <label><input [(ngModel)]="options.o" name="feedType" type="radio" value="ATOM"><strong>ATOM</strong>-->
<!--                  (default)</label>-->
<!--                <label><input [(ngModel)]="options.o" name="feedType" type="radio" value="RSS">RSS</label>-->
<!--                <label><input [(ngModel)]="options.o" name="feedType" type="radio" value="JSON">JSON</label>-->
<!--              </li>-->
              <li>
                <p>Feed Entry Content</p>
                <label><input [(ngModel)]="options.c" name="entryContent" type="radio" value="RAW"><strong>Raw</strong>
                  (default)</label>
                <label><input [(ngModel)]="options.c" name="entryContent" type="radio" value="FULLTEXT">FullText</label>
                <label><input [(ngModel)]="options.c" name="entryContent" type="radio" value="OC_TAGS">OC Tags</label>
              </li>
            </ul>
          </div>
          <div *ngIf="isLoading"
               style="display:flex;justify-content:center; align-items:center;">
            <div class="spinner"></div>
          </div>
        </div>

        <div style="padding: 10px; display: flex;;"
             [ngClass]="{'feed-specified': currentRule, 'unsupported-website': error}">
          <!--      todo mag subsribe -->
          <!--      <div>-->
          <!--        <a href="" class="button secondary large">Subscribe for more</a>-->
          <!--      </div>-->
          <div>
            <a (click)="resetAll()" class="button" style="text-align: center">Reset Changes</a>

            <a *ngIf="currentRule"
               [href]="getFeedUrl()"
               class="button secondary large"
               target="_blank">Your {{ options.o }} Feed</a>
            <h3 *ngIf="!currentRule && !error">Your RSS Feed not yet specified</h3>
            <h3 *ngIf="error">Errors processing website</h3>
          </div>
        </div>

        <div style="text-align: center; line-height: 50px">
          <a href="https://github.com/damoeb/rss-proxy">rss-proxy</a> v. {{ getVersions().version }}
          @{{ getVersions().revision }} build on {{ getBuildDate() }}
          <a href="https://twitter.com/damoeb">contact</a>
        </div>

      </div>

      <div style="flex: 1; display: flex; flex-direction: column; border-left: 1px solid black; background: white">

        <div *ngIf="isLoading"
             style="display:flex;justify-content:center; align-items:center;">
          <div class="spinner"></div>
        </div>

        <div *ngIf="error" style="margin: 10px">
          <h2 class="error">{{error}}</h2>
          Most likely the website is JavaScript generated, which is not supported by rss-proxy directly.
          Check the <a href="https://github.com/damoeb/rss-proxy/wiki">documentation</a> for further help.
        </div>

        <div class="playground__panels">

          <!-- Visualization --------------------------------------------------------------------------------------------- -->

          <iframe #iframeElement
                  (load)="onIframeLoad()"
                  [hidden]="isLoading"
                  sandbox="allow-same-origin"
                  style="flex: 1; border: none"></iframe>

        </div>
      </div>
    </div>
  </div>
</div>
